@model IEnumerable<SingleTicketing.Data.Driver>
@Html.Partial("_DriverSuperAdmin.cshtml")

<div class="container mt-4">
    <h2>Drivers</h2>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ADD">Add Driver</button>
    <table class="table table-striped mt-2">
        <thead>
            <tr>
                <th>License Number</th>
                <th>User Name</th>
                <th>Full Name</th>
                <th>Middle Name</th>
               
                <th>Birthdate</th>
                <th>Remarks</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var driver in Model)
            {
                <tr data-id="@driver.Id">
                    <td>@driver.LicenseNumber</td>
                    <td>@driver.UserName</td>
                    <td>@($"{driver.FirstName} {driver.LastName}")</td>
                    <td>@driver.MiddleName</td>
                   
                    <td>@driver.Birthdate</td>
                       <td>@driver.Remarks</td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="showDetails(@driver.Id)">Details</button>
                        <button class="btn btn-warning btn-sm" onclick="editDriver(@driver.Id)">Edit</button>
                       
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
<div class="container mt-4">
    <!-- Add Driver Modal -->
    <div class="modal fade" id="ADD" tabindex="-1" aria-labelledby="ADD" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="ADD">Add Driver</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Form for Adding Driver (submitted directly to the server) -->
                    <form action="/Driver/Create" method="post">
                        <div class="form-group mb-3">
                            <label for="UserName">User Name</label>
                            <input type="text" name="UserName" id="UserName" class="form-control" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="FirstName">First Name</label>
                            <input type="text" name="FirstName" id="FirstName" class="form-control" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="LastName">Last Name</label>
                            <input type="text" name="LastName" id="LastName" class="form-control" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="MiddleName">MiddleName </label>
                            <input type="text" name="MiddleName" id="MiddleName" class="form-control" required>
                        </div>
                           <div class="form-group mb-3">
                            <label for="LicenseNumber">License Number</label>
                            <input type="text" name="LicenseNumber" id="LicenseNumber" class="form-control" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="Birthdate">Birthdate</label>
                            <input type="text" name="Birthdate" id="Birthdate" class="form-control" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="PlateNumber">PlateNumber</label>
                            <input type="text" name="PlateNumber" id="PlateNumber" class="form-control" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="LicenseRestrictions">LicenseRestrictions</label>
                            <input type="text" name="LicenseRestrictions" id="LicenseRestrictions" class="form-control" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="TOP">TOP</label>
                            <input type="text" name="TOP" id="TOP" class="form-control" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="TypeOfVehicle">TypeOfVehicle</label>
                            <input type="text" name="TypeOfVehicle" id="TypeOfVehicle" class="form-control" required>
                        </div>
                           <div class="form-group mb-3">
                            <label for="Demerit">Demerit</label>
                            <input type="number" name="Demerit" id="Demerit" class="form-control" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="Email">Email</label>
                            <input type="text" name="Email" id="Email" class="form-control" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="Remarks">Remarks</label>
                            <input type="text" name="Remarks" id="Remarks" class="form-control" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="Status">Status</label>
                            <input type="text" name="Status" id="Status" class="form-control" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="Cases">Cases</label>
                            <input type="text" name="Cases" id="Cases" class="form-control" required>
                        </div>
                         

                        <!-- Modal Footer with Form Submission -->
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary">Save Driver</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Driver Modal -->
<div class="modal fade" id="DriverModal" tabindex="-1" role="dialog" aria-labelledby="DriverModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="DriverModal">Driver</h5>
               
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Load create driver partial view here -->
            </div>
        </div>
    </div>
</div>
 

<script>
      function loadCreateDriverForm() {
        $.get('@Url.Action("Create", "Driver")', function (data) {
            // Load the returned partial view into the modal body
            $('#createDriverModalBody').html(data);
            // Show the modal
            $('#createDriverModal').modal('show');
        });
    }

    // Bind the click event for the "Add Driver" button
    $('#createDriverBtn').click(function () {
        loadCreateDriverForm();
    });

    // Optionally, reset the modal body content after the modal is hidden to ensure a clean state
    $('#createDriverModal').on('hidden.bs.modal', function () {
        $('#createDriverModalBody').html('');  // Clear modal content when hidden
    });
    function showDetails(id) {
        $.get('@Url.Action("Details", "Driver")/' + id, function (data) {
            $('#modalBody').html(data);
            $('#DriverModal').modal('show');
        }).fail(function(xhr) {
            console.error("Error fetching driver details: ", xhr);
        });
    }

    function editDriver(id) {
        $.get('@Url.Action("Edit", "Driver")/' + id, function (data) {
            $('#modalBody').html(data);
            $('#DriverModal').modal('show');
        });
    }

    $('#DriverModal').on('show.bs.modal', function () {
        $.get('@Url.Action("Create", "Driver")', function (data) {
            $('#modalBody').html(data);
        });
    });
</script>
